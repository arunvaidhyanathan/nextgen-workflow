openapi: 3.0.3
info:
  title: Entitlement Service API
  description: |
    NextGen Workflow Entitlement Service - Central authority for authentication, authorization, and user management.
    
    This service provides:
    - Session-based authentication
    - Cerbos policy-based authorization
    - User and role management
    - Business application management
    
    **Authentication**: All endpoints except `/api/auth/login` require session-based authentication via `X-Session-Id` header.
    
    **Authorization**: Fine-grained access control is provided through Cerbos policy engine integration.
  version: 1.0.0
  contact:
    name: NextGen Workflow Team
servers:
  - url: http://localhost:8081
    description: Development server

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Authorization
    description: Policy-based authorization checks
  - name: Users
    description: User management operations
  - name: Business Applications
    description: Business application management
  - name: Business App Roles
    description: Business application role management
  - name: User Business App Roles
    description: User role assignment management
  - name: Policies
    description: Policy management and validation
  - name: Departments
    description: Department management operations
  - name: User Department Assignments
    description: User department assignment management
  - name: System Testing
    description: System testing and validation endpoints
  - name: EMS
    description: Enterprise Management System API for frontend integration

paths:
  # EMS endpoints for frontend integration
  /api/ems/v1/whoami:
    get:
      tags:
        - EMS
      summary: Get current user context
      description: |
        Retrieve comprehensive user information including roles, departments, 
        and permissions for frontend application use.
        
        **Authentication**: Requires either X-Session-Id or X-User-Id header
      parameters:
        - $ref: '#/components/parameters/SessionId'
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: User context retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WhoAmIResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
          
  /api/ems/v1/caniuse:
    post:
      tags:
        - EMS
      summary: Check user authorization
      description: |
        Check if the current user can perform specific actions on resources.
        Returns detailed authorization decisions for frontend use.
        
        **Authentication**: Requires either X-Session-Id or X-User-Id header
      parameters:
        - $ref: '#/components/parameters/SessionId'
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EMSAuthRequest'
            examples:
              specific_action:
                summary: Check specific action on resource
                value:
                  resourceId: "CMS-10-20045"
                  actionId: "CREATE_CASE"
                  resourceType: "case"
                  context:
                    department: "HR"
                    priority: "HIGH"
              resource_check:
                summary: Check common actions for resource type
                value:
                  resourceType: "case"
                  context:
                    department: "IU"
              minimal_check:
                summary: Minimal authorization check
                value:
                  actionId: "READ_CASE"
      responses:
        '200':
          description: Authorization check completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EMSAuthResponse'
        '400':
          description: Bad request - invalid request format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

paths:
  # Authentication endpoints
  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and create session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: alice.intake
                password:
                  type: string
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  sessionId:
                    type: string
                    example: "550e8400-e29b-41d4-a716-446655440000"
                  user:
                    $ref: '#/components/schemas/UserInfo'
                  message:
                    type: string
                    example: "Login successful"
        '400':
          description: Bad request - missing credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials or inactive user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: User logout
      description: Invalidate user session
      parameters:
        - $ref: '#/components/parameters/SessionId'
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                  description: Alternative way to provide session ID
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Logout successful"

  /api/auth/validate-session:
    get:
      tags:
        - Authentication
      summary: Validate session
      description: Check if user session is valid and active
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '200':
          description: Session is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    $ref: '#/components/schemas/UserInfo'
                  message:
                    type: string
                    example: "Session is valid"
        '401':
          description: Invalid or expired session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/user:
    get:
      tags:
        - Authentication
      summary: Get current user
      description: Get current authenticated user information
      parameters:
        - $ref: '#/components/parameters/SessionId'
      responses:
        '200':
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    $ref: '#/components/schemas/UserInfo'
        '401':
          description: Invalid or expired session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/validate:
    get:
      tags:
        - Authentication
      summary: Validate user (Gateway compatibility)
      description: Validate user by user ID for API Gateway compatibility
      parameters:
        - name: X-User-Id
          in: header
          required: false
          schema:
            type: string
          description: User ID for validation
      responses:
        '200':
          description: User is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    $ref: '#/components/schemas/UserInfo'
                  message:
                    type: string
                    example: "User is valid"
        '401':
          description: User not found or inactive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Authorization endpoints
  /api/entitlements/check:
    post:
      tags:
        - Authorization
      summary: Check authorization
      description: Perform authorization check using Cerbos policies
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationCheckRequest'
      responses:
        '200':
          description: Authorization check completed (check 'allowed' field for result)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationCheckResponse'

  /api/entitlements/health:
    get:
      tags:
        - Authorization
      summary: Health check
      description: Simple health check endpoint
      responses:
        '200':
          description: Service is running
          content:
            text/plain:
              schema:
                type: string
                example: "Entitlement Service is running"

  # User management endpoints
  /api/entitlements/users:
    get:
      tags:
        - Users
      summary: Get all users
      description: Retrieve all users in the system
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

    post:
      tags:
        - Users
      summary: Create user
      description: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid user data

  /api/entitlements/users/{id}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: Retrieve a specific user by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

    put:
      tags:
        - Users
      summary: Update user
      description: Update an existing user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

    delete:
      tags:
        - Users
      summary: Delete user
      description: Delete a user
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '204':
          description: User deleted successfully
        '404':
          description: User not found

  /api/entitlements/users/username/{username}:
    get:
      tags:
        - Users
      summary: Get user by username
      description: Retrieve a user by username
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          description: Username
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

  /api/entitlements/users/email/{email}:
    get:
      tags:
        - Users
      summary: Get user by email
      description: Retrieve a user by email address
      parameters:
        - name: email
          in: path
          required: true
          schema:
            type: string
          description: Email address
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

  /api/entitlements/users/active:
    get:
      tags:
        - Users
      summary: Get active users
      description: Retrieve all active users
      responses:
        '200':
          description: Active users retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /api/entitlements/users/{id}/activate:
    patch:
      tags:
        - Users
      summary: Activate user
      description: Activate a user account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: User activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

  /api/entitlements/users/{id}/deactivate:
    patch:
      tags:
        - Users
      summary: Deactivate user
      description: Deactivate a user account
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: User deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found

  # Business Application endpoints
  /api/entitlements/business-applications:
    get:
      tags:
        - Business Applications
      summary: Get all business applications
      description: Retrieve all business applications
      responses:
        '200':
          description: Business applications retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessApplication'

    post:
      tags:
        - Business Applications
      summary: Create business application
      description: Create a new business application
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessApplication'
      responses:
        '201':
          description: Business application created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '400':
          description: Invalid business application data

  /api/entitlements/business-applications/{id}:
    get:
      tags:
        - Business Applications
      summary: Get business application by ID
      description: Retrieve a specific business application by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '200':
          description: Business application found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '404':
          description: Business application not found

    put:
      tags:
        - Business Applications
      summary: Update business application
      description: Update an existing business application
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessApplication'
      responses:
        '200':
          description: Business application updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '404':
          description: Business application not found

    delete:
      tags:
        - Business Applications
      summary: Delete business application
      description: Delete a business application
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '204':
          description: Business application deleted successfully
        '404':
          description: Business application not found

  /api/entitlements/business-applications/name/{businessAppName}:
    get:
      tags:
        - Business Applications
      summary: Get business application by name
      description: Retrieve a business application by name
      parameters:
        - name: businessAppName
          in: path
          required: true
          schema:
            type: string
          description: Business application name
      responses:
        '200':
          description: Business application found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '404':
          description: Business application not found

  /api/entitlements/business-applications/active:
    get:
      tags:
        - Business Applications
      summary: Get active business applications
      description: Retrieve all active business applications
      responses:
        '200':
          description: Active business applications retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessApplication'

  /api/entitlements/business-applications/{id}/activate:
    patch:
      tags:
        - Business Applications
      summary: Activate business application
      description: Activate a business application
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '200':
          description: Business application activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '404':
          description: Business application not found

  /api/entitlements/business-applications/{id}/deactivate:
    patch:
      tags:
        - Business Applications
      summary: Deactivate business application
      description: Deactivate a business application
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '200':
          description: Business application deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessApplication'
        '404':
          description: Business application not found

  # Business App Roles endpoints
  /api/entitlements/business-app-roles:
    get:
      tags:
        - Business App Roles
      summary: Get all business app roles
      description: Retrieve all business application roles
      responses:
        '200':
          description: Business app roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessAppRole'

    post:
      tags:
        - Business App Roles
      summary: Create business app role
      description: Create a new business application role
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessAppRole'
      responses:
        '201':
          description: Business app role created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '400':
          description: Invalid business app role data

  /api/entitlements/business-app-roles/{id}:
    get:
      tags:
        - Business App Roles
      summary: Get business app role by ID
      description: Retrieve a specific business app role by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business app role ID
      responses:
        '200':
          description: Business app role found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '404':
          description: Business app role not found

    put:
      tags:
        - Business App Roles
      summary: Update business app role
      description: Update an existing business app role
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business app role ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BusinessAppRole'
      responses:
        '200':
          description: Business app role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '404':
          description: Business app role not found

    delete:
      tags:
        - Business App Roles
      summary: Delete business app role
      description: Delete a business app role
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business app role ID
      responses:
        '204':
          description: Business app role deleted successfully
        '404':
          description: Business app role not found

  /api/entitlements/business-app-roles/business-application/{businessAppId}:
    get:
      tags:
        - Business App Roles
      summary: Get roles by business application
      description: Retrieve all roles for a specific business application
      parameters:
        - name: businessAppId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessAppRole'

  /api/entitlements/business-app-roles/business-application/{businessAppId}/active:
    get:
      tags:
        - Business App Roles
      summary: Get active roles by business application
      description: Retrieve all active roles for a specific business application
      parameters:
        - name: businessAppId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
      responses:
        '200':
          description: Active roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessAppRole'

  /api/entitlements/business-app-roles/business-application/{businessAppId}/role/{roleName}:
    get:
      tags:
        - Business App Roles
      summary: Get role by business application and name
      description: Retrieve a specific role by business application and role name
      parameters:
        - name: businessAppId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business application ID
        - name: roleName
          in: path
          required: true
          schema:
            type: string
          description: Role name
      responses:
        '200':
          description: Role found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '404':
          description: Role not found

  /api/entitlements/business-app-roles/active:
    get:
      tags:
        - Business App Roles
      summary: Get all active business app roles
      description: Retrieve all active business application roles
      responses:
        '200':
          description: Active business app roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BusinessAppRole'

  /api/entitlements/business-app-roles/{id}/activate:
    patch:
      tags:
        - Business App Roles
      summary: Activate business app role
      description: Activate a business app role
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business app role ID
      responses:
        '200':
          description: Business app role activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '404':
          description: Business app role not found

  /api/entitlements/business-app-roles/{id}/deactivate:
    patch:
      tags:
        - Business App Roles
      summary: Deactivate business app role
      description: Deactivate a business app role
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Business app role ID
      responses:
        '200':
          description: Business app role deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BusinessAppRole'
        '404':
          description: Business app role not found

  # User Business App Roles endpoints
  /api/entitlements/user-business-app-roles:
    get:
      tags:
        - User Business App Roles
      summary: Get all user role assignments
      description: Retrieve all user business app role assignments
      responses:
        '200':
          description: User role assignments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

    post:
      tags:
        - User Business App Roles
      summary: Create user role assignment
      description: Create a new user business app role assignment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBusinessAppRole'
      responses:
        '201':
          description: User role assignment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '400':
          description: Invalid user role assignment data

  /api/entitlements/user-business-app-roles/{id}:
    get:
      tags:
        - User Business App Roles
      summary: Get user role assignment by ID
      description: Retrieve a specific user role assignment by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User role assignment ID
      responses:
        '200':
          description: User role assignment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '404':
          description: User role assignment not found

    put:
      tags:
        - User Business App Roles
      summary: Update user role assignment
      description: Update an existing user role assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User role assignment ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserBusinessAppRole'
      responses:
        '200':
          description: User role assignment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '404':
          description: User role assignment not found

    delete:
      tags:
        - User Business App Roles
      summary: Delete user role assignment
      description: Delete a user role assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User role assignment ID
      responses:
        '204':
          description: User role assignment deleted successfully
        '404':
          description: User role assignment not found

  /api/entitlements/user-business-app-roles/user/{userId}:
    get:
      tags:
        - User Business App Roles
      summary: Get user roles by user ID
      description: Retrieve all role assignments for a specific user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: User roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

  /api/entitlements/user-business-app-roles/user/{userId}/active:
    get:
      tags:
        - User Business App Roles
      summary: Get active user roles by user ID
      description: Retrieve all active role assignments for a specific user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: Active user roles retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

  /api/entitlements/user-business-app-roles/role/{roleId}:
    get:
      tags:
        - User Business App Roles
      summary: Get users by role ID
      description: Retrieve all users assigned to a specific role
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Role ID
      responses:
        '200':
          description: Users with role retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

  /api/entitlements/user-business-app-roles/role/{roleId}/active:
    get:
      tags:
        - User Business App Roles
      summary: Get active users by role ID
      description: Retrieve all active users assigned to a specific role
      parameters:
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Role ID
      responses:
        '200':
          description: Active users with role retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

  /api/entitlements/user-business-app-roles/user/{userId}/role/{roleId}:
    get:
      tags:
        - User Business App Roles
      summary: Get specific user role assignment
      description: Retrieve a specific user role assignment by user ID and role ID
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
        - name: roleId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Role ID
      responses:
        '200':
          description: User role assignment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '404':
          description: User role assignment not found

  /api/entitlements/user-business-app-roles/active:
    get:
      tags:
        - User Business App Roles
      summary: Get all active user role assignments
      description: Retrieve all active user business app role assignments
      responses:
        '200':
          description: Active user role assignments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserBusinessAppRole'

  /api/entitlements/user-business-app-roles/{id}/activate:
    patch:
      tags:
        - User Business App Roles
      summary: Activate user role assignment
      description: Activate a user role assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User role assignment ID
      responses:
        '200':
          description: User role assignment activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '404':
          description: User role assignment not found

  /api/entitlements/user-business-app-roles/{id}/deactivate:
    patch:
      tags:
        - User Business App Roles
      summary: Deactivate user role assignment
      description: Deactivate a user role assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User role assignment ID
      responses:
        '200':
          description: User role assignment deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '404':
          description: User role assignment not found

  /api/entitlements/user-business-app-roles/assign:
    post:
      tags:
        - User Business App Roles
      summary: Assign role to user
      description: Assign a role to a user or activate existing assignment
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
        - name: roleId
          in: query
          required: true
          schema:
            type: integer
            format: int64
          description: Role ID
      responses:
        '200':
          description: Role assignment activated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '201':
          description: New role assignment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserBusinessAppRole'
        '400':
          description: Invalid assignment data

  /api/entitlements/user-business-app-roles/revoke:
    post:
      tags:
        - User Business App Roles
      summary: Revoke role from user
      description: Revoke a role from a user (deactivate assignment)
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
        - name: roleId
          in: query
          required: true
          schema:
            type: integer
            format: int64
          description: Role ID
      responses:
        '204':
          description: Role revoked successfully
        '404':
          description: Assignment not found

  # Policy endpoints
  /api/policies/status:
    get:
      tags:
        - Policies
      summary: Get policy status
      description: Get policy status and inventory information
      responses:
        '200':
          description: Policy status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  cerbosConnected:
                    type: boolean
                    example: true
                  inventoryLogged:
                    type: boolean
                    example: true
                  status:
                    type: string
                    example: "OK"
                  message:
                    type: string
                    example: "Policy service is operational"
        '500':
          description: Policy service check failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ERROR"
                  message:
                    type: string
                    example: "Policy service check failed: connection error"

  /api/policies/validate:
    post:
      tags:
        - Policies
      summary: Validate policies
      description: Validate all policy files
      responses:
        '200':
          description: Policies validated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "VALID"
                  message:
                    type: string
                    example: "All policy files validated successfully"
        '400':
          description: Policy validation failed
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "INVALID"
                  message:
                    type: string
                    example: "Policy validation failed: syntax error"

  /api/policies/content/{policyType}/{fileName}:
    get:
      tags:
        - Policies
      summary: Get policy file content
      description: Retrieve the content of a specific policy file (for debugging)
      parameters:
        - name: policyType
          in: path
          required: true
          schema:
            type: string
          description: Policy type (e.g., resources, derived_roles)
        - name: fileName
          in: path
          required: true
          schema:
            type: string
          description: Policy file name
      responses:
        '200':
          description: Policy content retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  policyType:
                    type: string
                    example: "resources"
                  fileName:
                    type: string
                    example: "case.yaml"
                  content:
                    type: string
                    example: "apiVersion: api.cerbos.dev/v1..."
                  contentLength:
                    type: integer
                    example: 1234
        '404':
          description: Policy file not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ERROR"
                  message:
                    type: string
                    example: "Failed to retrieve policy content: file not found"

  # Department management endpoints
  /api/entitlements/departments:
    get:
      tags:
        - Departments
      summary: Get all departments
      description: Retrieve all departments in the system
      responses:
        '200':
          description: Departments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Department'

    post:
      tags:
        - Departments
      summary: Create department
      description: Create a new department
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Department'
      responses:
        '201':
          description: Department created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '400':
          description: Invalid department data

  /api/entitlements/departments/{id}:
    get:
      tags:
        - Departments
      summary: Get department by ID
      description: Retrieve a specific department by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Department found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

    put:
      tags:
        - Departments
      summary: Update department
      description: Update an existing department
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Department'
      responses:
        '200':
          description: Department updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

    delete:
      tags:
        - Departments
      summary: Delete department
      description: Delete a department
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '204':
          description: Department deleted successfully
        '404':
          description: Department not found

  /api/entitlements/departments/name/{departmentName}:
    get:
      tags:
        - Departments
      summary: Get department by name
      description: Retrieve a department by name
      parameters:
        - name: departmentName
          in: path
          required: true
          schema:
            type: string
          description: Department name
      responses:
        '200':
          description: Department found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

  /api/entitlements/departments/code/{departmentCode}:
    get:
      tags:
        - Departments
      summary: Get department by code
      description: Retrieve a department by department code
      parameters:
        - name: departmentCode
          in: path
          required: true
          schema:
            type: string
          description: Department code
      responses:
        '200':
          description: Department found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

  /api/entitlements/departments/active:
    get:
      tags:
        - Departments
      summary: Get active departments
      description: Retrieve all active departments
      responses:
        '200':
          description: Active departments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Department'

  /api/entitlements/departments/{id}/activate:
    patch:
      tags:
        - Departments
      summary: Activate department
      description: Activate a department
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Department activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

  /api/entitlements/departments/{id}/deactivate:
    patch:
      tags:
        - Departments
      summary: Deactivate department
      description: Deactivate a department
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Department deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'
        '404':
          description: Department not found

  # User Department Assignment endpoints
  /api/entitlements/user-departments:
    get:
      tags:
        - User Department Assignments
      summary: Get all user department assignments
      description: Retrieve all user department assignments
      responses:
        '200':
          description: User department assignments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

    post:
      tags:
        - User Department Assignments
      summary: Create user department assignment
      description: Create a new user department assignment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserDepartment'
      responses:
        '201':
          description: User department assignment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '400':
          description: Invalid user department assignment data

  /api/entitlements/user-departments/{id}:
    get:
      tags:
        - User Department Assignments
      summary: Get user department assignment by ID
      description: Retrieve a specific user department assignment by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User department assignment ID
      responses:
        '200':
          description: User department assignment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '404':
          description: User department assignment not found

    put:
      tags:
        - User Department Assignments
      summary: Update user department assignment
      description: Update an existing user department assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User department assignment ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserDepartment'
      responses:
        '200':
          description: User department assignment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '404':
          description: User department assignment not found

    delete:
      tags:
        - User Department Assignments
      summary: Delete user department assignment
      description: Delete a user department assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User department assignment ID
      responses:
        '204':
          description: User department assignment deleted successfully
        '404':
          description: User department assignment not found

  /api/entitlements/user-departments/user/{userId}:
    get:
      tags:
        - User Department Assignments
      summary: Get user departments by user ID
      description: Retrieve all department assignments for a specific user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: User departments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

  /api/entitlements/user-departments/user/{userId}/active:
    get:
      tags:
        - User Department Assignments
      summary: Get active user departments by user ID
      description: Retrieve all active department assignments for a specific user
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
      responses:
        '200':
          description: Active user departments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

  /api/entitlements/user-departments/department/{departmentId}:
    get:
      tags:
        - User Department Assignments
      summary: Get users by department ID
      description: Retrieve all users assigned to a specific department
      parameters:
        - name: departmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Users in department retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

  /api/entitlements/user-departments/department/{departmentId}/active:
    get:
      tags:
        - User Department Assignments
      summary: Get active users by department ID
      description: Retrieve all active users assigned to a specific department
      parameters:
        - name: departmentId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Active users in department retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

  /api/entitlements/user-departments/active:
    get:
      tags:
        - User Department Assignments
      summary: Get all active user department assignments
      description: Retrieve all active user department assignments
      responses:
        '200':
          description: Active user department assignments retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserDepartment'

  /api/entitlements/user-departments/{id}/activate:
    patch:
      tags:
        - User Department Assignments
      summary: Activate user department assignment
      description: Activate a user department assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User department assignment ID
      responses:
        '200':
          description: User department assignment activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '404':
          description: User department assignment not found

  /api/entitlements/user-departments/{id}/deactivate:
    patch:
      tags:
        - User Department Assignments
      summary: Deactivate user department assignment
      description: Deactivate a user department assignment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: User department assignment ID
      responses:
        '200':
          description: User department assignment deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '404':
          description: User department assignment not found

  /api/entitlements/user-departments/assign:
    post:
      tags:
        - User Department Assignments
      summary: Assign user to department
      description: Assign a user to a department or activate existing assignment
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
        - name: departmentId
          in: query
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '200':
          description: Department assignment activated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '201':
          description: New department assignment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserDepartment'
        '400':
          description: Invalid assignment data

  /api/entitlements/user-departments/revoke:
    post:
      tags:
        - User Department Assignments
      summary: Remove user from department
      description: Remove a user from a department (deactivate assignment)
      parameters:
        - name: userId
          in: query
          required: true
          schema:
            type: string
            format: uuid
          description: User ID (UUID format)
        - name: departmentId
          in: query
          required: true
          schema:
            type: integer
            format: int64
          description: Department ID
      responses:
        '204':
          description: Department assignment removed successfully
        '404':
          description: Assignment not found

  # System Testing endpoints  
  /api/system-test/users/uuid-test:
    get:
      tags:
        - System Testing
      summary: Test UUID user operations
      description: Tests hybrid schema with UUID-based user operations and lookups
      responses:
        '200':
          description: UUID user test results
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalActiveUsers:
                    type: integer
                    example: 10
                  aliceFound:
                    type: boolean
                    example: true
                  bobFound:
                    type: boolean
                    example: true
                  aliceUserId:
                    type: string
                    format: uuid
                    example: "550e8400-e29b-41d4-a716-446655440001"
                  bobUserId:
                    type: string
                    format: uuid
                    example: "550e8400-e29b-41d4-a716-446655440002"
                  sampleUser:
                    $ref: '#/components/schemas/User'
        '500':
          description: Internal server error

  /api/system-test/user-roles/uuid-test:
    get:
      tags:
        - System Testing
      summary: Test UUID user-role assignments
      description: Tests user-role assignment operations with UUID-based lookups
      responses:
        '200':
          description: UUID user-role test results
          content:
            application/json:
              schema:
                type: object
                properties:
                  aliceUserId:
                    type: string
                    format: uuid
                    example: "550e8400-e29b-41d4-a716-446655440001"
                  totalRoles:
                    type: integer
                    example: 2
                  activeRoles:
                    type: integer
                    example: 2
                  roleDetails:
                    type: array
                    items:
                      type: object
                      properties:
                        roleName:
                          type: string
                          example: "INTAKE_ANALYST"
                        applicationName:
                          type: string
                          example: "onecms"
                        isActive:
                          type: boolean
                          example: true
        '500':
          description: Internal server error

  /api/system-test/authorization/engine-test:
    post:
      tags:
        - System Testing
      summary: Test authorization engine functionality
      description: Tests the hybrid authorization system with configurable parameters
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: "alice.intake"
                  default: "alice.intake"
                resource:
                  type: string
                  example: "case"
                  default: "case"
                action:
                  type: string
                  example: "create"
                  default: "create"
      responses:
        '200':
          description: Authorization engine test results
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    example: "alice.intake"
                  userId:
                    type: string
                    format: uuid
                    example: "550e8400-e29b-41d4-a716-446655440001"
                  resource:
                    type: string
                    example: "case"
                  action:
                    type: string
                    example: "create"
                  authorizationResult:
                    type: object
                    properties:
                      allowed:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: "Access granted"
                      validationResult:
                        type: string
                        example: "none"
        '500':
          description: Internal server error

  /api/system-test/status:
    get:
      tags:
        - System Testing
      summary: Get system status and configuration
      description: Returns overall system health and entity counts for hybrid architecture validation
      responses:
        '200':
          description: System status information
          content:
            application/json:
              schema:
                type: object
                properties:
                  hybridSchema:
                    type: string
                    example: "active"
                  entityCounts:
                    type: object
                    properties:
                      totalUsers:
                        type: integer
                        example: 10
                      activeUsers:
                        type: integer
                        example: 10
                      totalRoleAssignments:
                        type: integer
                        example: 20
                      activeRoleAssignments:
                        type: integer
                        example: 18
                  systemReady:
                    type: boolean
                    example: true
                  timestamp:
                    type: integer
                    format: int64
                    example: 1640995200000
        '500':
          description: Internal server error

components:
  parameters:
    SessionId:
      name: X-Session-Id
      in: header
      required: false
      schema:
        type: string
      description: Session ID for authentication

    UserId:
      name: X-User-Id
      in: header
      required: false
      schema:
        type: string
        format: uuid
      description: Direct user ID for API Gateway integration

  schemas:
    UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        username:
          type: string
          example: "alice.intake"
        email:
          type: string
          example: "alice.intake@company.com"
        firstName:
          type: string
          example: "Alice"
        lastName:
          type: string
          example: "Smith"
        isActive:
          type: boolean
          example: true
        attributes:
          type: object
          additionalProperties: true
          example:
            department: "HR"
            role: "INTAKE_ANALYST"

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        username:
          type: string
          example: "alice.intake"
        email:
          type: string
          example: "alice.intake@company.com"
        firstName:
          type: string
          example: "Alice"
        lastName:
          type: string
          example: "Smith"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        attributes:
          type: object
          additionalProperties: true
          example:
            department: "HR"
            role: "INTAKE_ANALYST"

    BusinessApplication:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        businessAppName:
          type: string
          example: "onecms"
        description:
          type: string
          example: "OneCMS Case Management System"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        metadata:
          type: object
          additionalProperties: true
          example:
            version: "1.0.0"
            owner: "Case Management Team"

    BusinessAppRole:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        businessApplication:
          $ref: '#/components/schemas/BusinessApplication'
        roleName:
          type: string
          example: "INTAKE_ANALYST"
        roleDisplayName:
          type: string
          example: "Intake Analyst"
        description:
          type: string
          example: "Analyst responsible for case intake and initial review"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        metadata:
          type: object
          additionalProperties: true
          example:
            permissions: ["READ", "CREATE"]
            queue: "intake-analyst-queue"

    UserBusinessAppRole:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        userId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        businessAppRole:
          $ref: '#/components/schemas/BusinessAppRole'
        isActive:
          type: boolean
          example: true

    AuthorizationCheckRequest:
      type: object
      required:
        - principal
        - resource
        - action
      properties:
        principal:
          type: object
          required:
            - id
          properties:
            id:
              type: string
              format: uuid
              example: "550e8400-e29b-41d4-a716-446655440001"
            attributes:
              type: object
              additionalProperties: true
              example:
                roles: ["INTAKE_ANALYST"]
                departments: ["HR"]
                queues: ["intake-analyst-queue"]
        resource:
          type: object
          required:
            - kind
            - id
          properties:
            kind:
              type: string
              example: "case"
            id:
              type: string
              example: "case123"
            attributes:
              type: object
              additionalProperties: true
              example:
                status: "OPEN"
                department: "HR"
                assignedTo: "user456"
        action:
          type: string
          example: "read"
          enum: ["read", "create", "update", "delete", "claim", "complete", "approve"]

    AuthorizationCheckResponse:
      type: object
      properties:
        allowed:
          type: boolean
          example: true
        message:
          type: string
          example: "Access granted"
        validationResult:
          type: string
          example: "Policy evaluation successful"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error message"

    Department:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        departmentName:
          type: string
          example: "Human Resources"
        departmentCode:
          type: string
          example: "HR"
        description:
          type: string
          example: "Human Resources Department"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"

    UserDepartment:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        userId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        department:
          $ref: '#/components/schemas/Department'
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2025-01-01T00:00:00Z"

    # EMS endpoint schemas
    EMSAuthRequest:
      type: object
      properties:
        resourceId:
          type: string
          description: Resource identifier
          example: "CMS-10-20045"
        actionId:
          type: string
          description: Action identifier
          example: "CREATE_CASE"
        resourceType:
          type: string
          description: Resource type
          example: "case"
        context:
          type: object
          additionalProperties: true
          description: Additional context information
          example:
            department: "HR"
            priority: "HIGH"

    EMSAuthResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the request was processed successfully
          example: true
        actions:
          type: array
          items:
            type: object
            properties:
              actionId:
                type: string
                description: Action identifier
                example: "CREATE_CASE"
              displayName:
                type: string
                description: Human-readable action name
                example: "Create Case"
              allowed:
                type: boolean
                description: Whether the action is allowed
                example: true
              reason:
                type: string
                description: Reason for the authorization decision
                example: "User has INTAKE_ANALYST role"
        resourceAccess:
          type: object
          properties:
            canRead:
              type: boolean
              description: Can read the resource
              example: true
            canWrite:
              type: boolean
              description: Can write/update the resource
              example: true
            canDelete:
              type: boolean
              description: Can delete the resource
              example: false
            canApprove:
              type: boolean
              description: Can approve actions on the resource
              example: false
        derivedRoles:
          type: array
          items:
            type: string
          description: List of derived roles applied during evaluation
          example: ["user", "case_creator"]
        evaluationTime:
          type: integer
          format: int64
          description: Policy evaluation time in milliseconds
          example: 45

    WhoAmIResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Whether the request was processed successfully
          example: true
        user:
          type: object
          properties:
            id:
              type: string
              format: uuid
              description: User UUID
              example: "550e8400-e29b-41d4-a716-446655440001"
            username:
              type: string
              description: Username
              example: "alice.intake"
            email:
              type: string
              description: Email address
              example: "alice.intake@company.com"
            firstName:
              type: string
              description: First name
              example: "Alice"
            lastName:
              type: string
              description: Last name
              example: "Johnson"
            displayName:
              type: string
              description: Full display name
              example: "Alice Johnson"
            isActive:
              type: boolean
              description: Whether the user account is active
              example: true
            attributes:
              type: object
              additionalProperties: true
              description: User's global attributes
              example:
                department: "IU"
                clearance: "standard"
        roles:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                format: int64
                description: Role ID
                example: 1
              roleName:
                type: string
                description: Role name
                example: "INTAKE_ANALYST"
              displayName:
                type: string
                description: Role display name
                example: "Intake Analyst"
              businessApplication:
                type: string
                description: Business application name
                example: "onecms"
              isActive:
                type: boolean
                description: Whether the role assignment is active
                example: true
              metadata:
                type: object
                additionalProperties: true
                description: Role metadata including queue information
                example:
                  queue: "intake-analyst-queue"
        departments:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                format: int64
                description: Department ID
                example: 1
              name:
                type: string
                description: Department name
                example: "Investigation Unit"
              code:
                type: string
                description: Department code
                example: "IU"
              isActive:
                type: boolean
                description: Whether the department assignment is active
                example: true
        permissions:
          type: array
          items:
            type: object
            properties:
              resource:
                type: string
                description: Resource type
                example: "case"
              actions:
                type: array
                items:
                  type: string
                description: Available actions on the resource
                example: ["create", "read", "update", "route"]
        context:
          type: object
          properties:
            sessionExpiration:
              type: string
              format: date-time
              description: Session expiration timestamp
              example: "2025-01-09T12:00:00Z"
            lastAccessed:
              type: string
              format: date-time
              description: Last access timestamp
              example: "2025-01-09T10:30:00Z"
            queues:
              type: array
              items:
                type: string
              description: Available queues for the user
              example: ["intake-analyst-queue", "eo-officer-queue"]