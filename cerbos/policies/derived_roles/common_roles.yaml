---
apiVersion: "api.cerbos.dev/v1"
derivedRoles:
  name: common_roles
  definitions:
    # Basic user role - all authenticated users
    - name: user
      parentRoles: ["authenticated"]
      
    # Manager role - users with management responsibilities  
    - name: manager
      parentRoles: ["user"]
      condition:
        match:
          expr: |
            has(P.attr.roles) && (
              "EO_HEAD" in P.attr.roles ||
              "ER_INVESTIGATION_MANAGER" in P.attr.roles ||
              "CSIS_INVESTIGATION_MANAGER" in P.attr.roles ||
              "CSIS_INTAKE_MANAGER" in P.attr.roles
            )
    
    # Department head role - highest level in department
    - name: department_head
      parentRoles: ["manager"]
      condition:
        match:
          expr: |
            has(P.attr.roles) && (
              "EO_HEAD" in P.attr.roles
            )
            
    # Investigation manager role
    - name: investigation_manager
      parentRoles: ["manager"] 
      condition:
        match:
          expr: |
            has(P.attr.roles) && (
              "ER_INVESTIGATION_MANAGER" in P.attr.roles ||
              "CSIS_INVESTIGATION_MANAGER" in P.attr.roles
            )
    
    # Intake analyst role
    - name: intake_analyst
      parentRoles: ["user"]
      condition:
        match:
          expr: |
            has(P.attr.roles) && (
              "EO_INTAKE_ANALYST" in P.attr.roles ||
              "ER_INTAKE_ANALYST" in P.attr.roles ||
              "CSIS_INTAKE_ANALYST" in P.attr.roles
            )
    
    # Investigator role
    - name: investigator
      parentRoles: ["user"]
      condition:
        match:
          expr: |
            has(P.attr.roles) && (
              "ER_INVESTIGATOR" in P.attr.roles ||
              "CSIS_INVESTIGATOR" in P.attr.roles
            )